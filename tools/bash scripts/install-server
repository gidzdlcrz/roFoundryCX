#!/bin/bash

set -e

# Clear screen
clear

# ASCII Logo
cat << "EOF"
            _____                     _            
  _ __ ___ |  ___|__  _   _ _ __   __| |_ __ _   _ 
 | '__/ _ \| |_ / _ \| | | | '_ \ / _` | '__| | | |
 | | | (_) |  _| (_) | |_| | | | | (_| | |  | |_| |
 |_|  \___/|_|  \___/ \__,_|_| |_|\__,_|_|   \__, |
                                             |___/ 
                         Copyright roFoundry
EOF

echo ""
echo "=========================================="
echo " rAthena Environment Installer"
echo " Powered by roFoundry"
echo "=========================================="
sleep 2

# Must be run as root
if [ "$EUID" -ne 0 ]; then
  echo "Please run this script as root (sudo)"
  exit 1
fi

echo "[1/14] Updating system..."
apt-get update && apt-get upgrade -y

echo "[2/14] Installing build tools and dependencies..."
apt-get install -y \
  git make gcc g++ \
  libmariadb-dev libmariadb-dev-compat \
  zlib1g-dev libpcre3-dev

echo "[3/14] Reinstalling bsdutils..."
apt-get --reinstall install -y bsdutils

echo "[4/14] Installing Apache2..."
apt-get install -y apache2

echo "[5/14] Installing MariaDB..."
apt-get install -y mariadb-server

echo "[6/14] Enabling MariaDB..."
systemctl enable mariadb
systemctl start mariadb

echo "[7/14] Securing MariaDB..."
mysql_secure_installation

echo "[8/14] Installing PHP and Apache PHP modules..."
apt-get install -y php libapache2-mod-php php-mysql

echo "[9/14] Installing phpMyAdmin..."
apt-get install -y phpmyadmin

echo "[10/14] Configuring phpMyAdmin for Apache..."
if [ ! -f /etc/apache2/conf-available/phpmyadmin.conf ]; then
  cp /etc/phpmyadmin/apache.conf /etc/apache2/conf-available/phpmyadmin.conf
fi

echo "[11/14] Enabling phpMyAdmin config..."
a2enconf phpmyadmin

echo "[12/14] Setting ownership for /var/www/html..."
chown -R www-data:www-data /var/www/html

echo "[13/14] Setting permissions for /var/www/html..."
chmod -R 775 /var/www/html

echo "[14/14] Restarting Apache..."
systemctl restart apache2

echo ""
echo "=========================================="
echo " Installation Complete!"
echo " phpMyAdmin: http://YOUR_SERVER_IP/phpmyadmin"
echo "=========================================="
